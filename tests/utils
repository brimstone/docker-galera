galera(){
	name="$1"
	shift
	docker rm -vf "$name" &>/dev/null || true
	docker run -d --name "$name" "$@" "${IMAGE:-galera}"
}

wait_for_synced(){
	cid="$1"
	echo "Waiting for $cid to shift to synced"

	starttime=$(date +%s)
	until docker logs "$cid" |& grep -q "Shifting JOINED -> SYNCED"; do
		printf "."
		[ $(date +%s) -gt $[ $starttime + 60 ] ] && break
		sleep 2
	done
	echo
	if [ $(date +%s) -lt $[ $starttime + 60 ] ]; then
		echo "Container $cid synced in $[ $(date +%s) - $starttime ] seconds"
	else
		echo "Container $cid didn't sync in time"
		docker logs "$cid"
		docker rm -vf "$cid"
		exit 1
	fi
}

cip(){
	docker inspect -f '{{.NetworkSettings.IPAddress}}' "$1"
}

sql(){
	cid=$1
	shift
	mysql -h "$(cip $cid)" -NB "$@"
}
